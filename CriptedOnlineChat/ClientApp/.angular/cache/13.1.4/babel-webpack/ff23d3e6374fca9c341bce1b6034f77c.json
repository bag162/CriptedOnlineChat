{"ast":null,"code":"import _asyncToGenerator from \"C:\\\\Users\\\\DELL\\\\source\\\\repos\\\\CriptedOnlineChat\\\\CriptedOnlineChat\\\\ClientApp\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\asyncToGenerator.js\";\nimport * as signalR from '@microsoft/signalr';\nimport { HubConnectionBuilder } from '@microsoft/signalr';\nimport * as forge from 'node-forge';\nimport { v4 as uuidv4 } from 'uuid';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/db\";\nimport * as i2 from \"./message.service\";\nexport class WebSocketService {\n  constructor(baseUrl, appDB, messageService) {\n    this.baseUrl = baseUrl + \"schatHub\";\n    this.messageService = messageService;\n    this.appDB = appDB;\n    this.HubConnection = new HubConnectionBuilder().configureLogging(signalR.LogLevel.Debug).withUrl(\"http://localhost:5172/schatHub\").build();\n    this.HubConnection.start();\n    this.initWebSocket();\n  }\n\n  initWebSocket() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      yield _this.HubConnection.on(\"Test\", message => {\n        console.log(message);\n      });\n      yield _this.HubConnection.on(\"AddNewRSAKeys\", rsaKeys => {\n        _this.AddNewRSAKeysServer(rsaKeys);\n      });\n      yield _this.HubConnection.on(\"AddNewMessages\", messages => {\n        _this.messageService.AddNewMessages(messages);\n      });\n    })();\n  }\n\n  sendMessage(message) {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      yield _this2.HubConnection.send(\"SendMessage\", message);\n    })();\n  }\n\n  SendPublicRSAKey(rsaKey) {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      yield _this3.HubConnection.send(\"SendRSAKeys\", rsaKey);\n    })();\n  }\n\n  AddNewRSAKeysServer(keys) {\n    var _this4 = this;\n\n    return _asyncToGenerator(function* () {\n      keys.forEach( /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator(function* (element) {\n          let insertedPubKey = {\n            id: uuidv4()\n          };\n          let n = new forge.jsbn.BigInteger(null);\n          n.s = element.ns;\n          n.t = element.nt;\n          n.data = JSON.parse(element.nDataJson);\n          let e = new forge.jsbn.BigInteger(null);\n          e.s = element.es;\n          e.t = element.et;\n          e.data = JSON.parse(element.eDataJson);\n          insertedPubKey.e = e;\n          insertedPubKey.n = n;\n\n          _this4.appDB.PublicKeyForEncript.add(insertedPubKey);\n\n          let isContaints = yield _this4.appDB.Contacts.filter(x => x.ContactId == element.senderUserId).count();\n\n          if (isContaints == 0) {\n            let newContact = {\n              Login: element.senderLogin\n            };\n            newContact.ContactId = element.senderUserId;\n            newContact.Login = element.senderLogin;\n            newContact.PublicKeyForEncriptId = insertedPubKey.id;\n\n            _this4.appDB.Contacts.add(newContact);\n          }\n        });\n\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }());\n    })();\n  }\n\n}\n\nWebSocketService.ɵfac = function WebSocketService_Factory(t) {\n  return new (t || WebSocketService)(i0.ɵɵinject('BASE_URL'), i0.ɵɵinject(i1.AppDB), i0.ɵɵinject(i2.MessageService));\n};\n\nWebSocketService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: WebSocketService,\n  factory: WebSocketService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"sources":["C:/Users/DELL/source/repos/CriptedOnlineChat/CriptedOnlineChat/ClientApp/src/app/Services/WebSocket.service.ts"],"names":["signalR","HubConnectionBuilder","forge","v4","uuidv4","i0","i1","i2","WebSocketService","constructor","baseUrl","appDB","messageService","HubConnection","configureLogging","LogLevel","Debug","withUrl","build","start","initWebSocket","on","message","console","log","rsaKeys","AddNewRSAKeysServer","messages","AddNewMessages","sendMessage","send","SendPublicRSAKey","rsaKey","keys","forEach","element","insertedPubKey","id","n","jsbn","BigInteger","s","ns","t","nt","data","JSON","parse","nDataJson","e","es","et","eDataJson","PublicKeyForEncript","add","isContaints","Contacts","filter","x","ContactId","senderUserId","count","newContact","Login","senderLogin","PublicKeyForEncriptId","ɵfac","WebSocketService_Factory","ɵɵinject","AppDB","MessageService","ɵprov","ɵɵdefineInjectable","token","factory","providedIn"],"mappings":"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","sourcesContent":["import * as signalR from '@microsoft/signalr';\r\nimport { HubConnectionBuilder } from '@microsoft/signalr';\r\nimport * as forge from 'node-forge';\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport * as i0 from \"@angular/core\";\r\nimport * as i1 from \"src/db\";\r\nimport * as i2 from \"./message.service\";\r\nexport class WebSocketService {\r\n    constructor(baseUrl, appDB, messageService) {\r\n        this.baseUrl = baseUrl + \"schatHub\";\r\n        this.messageService = messageService;\r\n        this.appDB = appDB;\r\n        this.HubConnection = new HubConnectionBuilder()\r\n            .configureLogging(signalR.LogLevel.Debug)\r\n            .withUrl(\"http://localhost:5172/schatHub\")\r\n            .build();\r\n        this.HubConnection.start();\r\n        this.initWebSocket();\r\n    }\r\n    async initWebSocket() {\r\n        await this.HubConnection.on(\"Test\", message => { console.log(message); });\r\n        await this.HubConnection.on(\"AddNewRSAKeys\", rsaKeys => { this.AddNewRSAKeysServer(rsaKeys); });\r\n        await this.HubConnection.on(\"AddNewMessages\", messages => { this.messageService.AddNewMessages(messages); });\r\n    }\r\n    async sendMessage(message) {\r\n        await this.HubConnection.send(\"SendMessage\", message);\r\n    }\r\n    async SendPublicRSAKey(rsaKey) {\r\n        await this.HubConnection.send(\"SendRSAKeys\", rsaKey);\r\n    }\r\n    async AddNewRSAKeysServer(keys) {\r\n        keys.forEach(async (element) => {\r\n            let insertedPubKey = { id: uuidv4() };\r\n            let n = new forge.jsbn.BigInteger(null);\r\n            n.s = element.ns;\r\n            n.t = element.nt;\r\n            n.data = JSON.parse(element.nDataJson);\r\n            let e = new forge.jsbn.BigInteger(null);\r\n            e.s = element.es;\r\n            e.t = element.et;\r\n            e.data = JSON.parse(element.eDataJson);\r\n            insertedPubKey.e = e;\r\n            insertedPubKey.n = n;\r\n            this.appDB.PublicKeyForEncript.add(insertedPubKey);\r\n            let isContaints = await this.appDB.Contacts.filter(x => x.ContactId == element.senderUserId).count();\r\n            if (isContaints == 0) {\r\n                let newContact = { Login: element.senderLogin };\r\n                newContact.ContactId = element.senderUserId;\r\n                newContact.Login = element.senderLogin;\r\n                newContact.PublicKeyForEncriptId = insertedPubKey.id;\r\n                this.appDB.Contacts.add(newContact);\r\n            }\r\n        });\r\n    }\r\n}\r\nWebSocketService.ɵfac = function WebSocketService_Factory(t) { return new (t || WebSocketService)(i0.ɵɵinject('BASE_URL'), i0.ɵɵinject(i1.AppDB), i0.ɵɵinject(i2.MessageService)); };\r\nWebSocketService.ɵprov = /*@__PURE__*/ i0.ɵɵdefineInjectable({ token: WebSocketService, factory: WebSocketService.ɵfac, providedIn: 'root' });\r\n"]},"metadata":{},"sourceType":"module"}